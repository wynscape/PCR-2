<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PCR: Molecular & Mathematical Growth</title>
    <style>
        :root {
            --parent: #ff851b; --primer-f: #f012be; --primer-r: #0074d9;
            --new: #333333; --bg: #ffffff; --border: #eeeeee;
        }
        * { box-sizing: border-box; -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; }
        body { 
            margin: 0; font-family: -apple-system, sans-serif; 
            background: var(--bg); color: #333; height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        /* --- Header --- */
        header { padding: 10px; border-bottom: 1px solid var(--border); text-align: center; }
        h1 { margin: 0; font-size: 1rem; letter-spacing: 1px; font-weight: 800; }

        /* --- Workspace (Top) --- */
        #workspace { height: 35%; position: relative; display: flex; flex-direction: column; justify-content: center; align-items: center; background: #fff; }
        .dna-box { position: relative; width: 80%; height: 120px; }
        .strand { position: absolute; width: 100%; height: 6px; border-radius: 3px; transition: all 0.6s ease; }
        .s-parent { background: var(--parent); }
        .s-new { background: var(--new); width: 0; }
        .primer { position: absolute; width: 25px; height: 10px; border-radius: 2px; opacity: 0; z-index: 5; transition: opacity 0.3s; }
        .p-f { background: var(--primer-f); top: 35%; right: 0; } /* Binds 3' of top strand */
        .p-r { background: var(--primer-r); bottom: 35%; left: 0; } /* Binds 3' of bottom strand */
        .label { position: absolute; font-size: 0.6rem; font-weight: bold; color: #ccc; }

        /* --- Results Panel (Bottom) --- */
        #results-panel { flex: 1; background: #fafafa; border-top: 2px solid var(--border); display: flex; flex-direction: column; padding: 10px; overflow-y: auto; }
        .cycle-row { margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #eee; display: flex; flex-direction: column; gap: 5px; }
        .row-header { display: flex; justify-content: space-between; font-size: 0.65rem; font-weight: bold; color: #888; text-transform: uppercase; }
        .strand-tray { display: flex; flex-wrap: wrap; gap: 3px; }
        
        /* Icons */
        .icon { height: 5px; width: 18px; border-radius: 2px; }
        .i-long { background: linear-gradient(90deg, var(--primer-f) 25%, var(--new) 75%); }
        .i-short { background: linear-gradient(90deg, var(--primer-f) 25%, var(--new) 50%, var(--primer-r) 25%); }
        .stat-val { color: #333; font-weight: 800; margin-left: 4px; }

        /* --- Controls --- */
        #controls { padding: 15px; border-top: 1px solid var(--border); background: white; display: flex; justify-content: center; align-items: center; gap: 15px; }
        button { padding: 10px 20px; border-radius: 20px; border: none; background: #222; color: white; font-weight: bold; cursor: pointer; font-size: 0.8rem; }
        button:disabled { opacity: 0.2; }
        #status-txt { font-size: 0.75rem; font-weight: bold; color: var(--primer-f); width: 140px; text-align: center; }

        @media (max-width: 600px) { h1 { font-size: 0.8rem; } #status-txt { width: 100px; font-size: 0.6rem; } }
    </style>
</head>
<body>

    <header><h1>PCR: CYCLE-BY-CYCLE GROWTH</h1></header>

    <div id="workspace">
        <div id="status-txt">Ready: Press Melt</div>
        <div class="dna-box">
            <!-- 5' to 3' (Top) -->
            <div id="top-t" class="strand s-parent" style="top: 30%;"></div>
            <div class="label" style="top: 22%; left: -20px;">5'</div>
            <div class="label" style="top: 22%; right: -20px;">3'</div>
            
            <!-- 3' to 5' (Bot) -->
            <div id="bot-t" class="strand s-parent" style="bottom: 30%;"></div>
            <div class="label" style="bottom: 22%; left: -20px;">3'</div>
            <div class="label" style="bottom: 22%; right: -20px;">5'</div>

            <!-- Primers & Synthesis -->
            <div id="p-f" class="primer p-f"></div>
            <div id="p-r" class="primer p-r"></div>
            
            <!-- Growing Strands (Physically attached to primers) -->
            <div id="syn-f" class="strand s-new" style="top: 30%; right: 25px;"></div>
            <div id="syn-r" class="strand s-new" style="bottom: 30%; left: 25px;"></div>
        </div>
    </div>

    <div id="results-panel" id="scroll-target">
        <!-- Results append here -->
        <div class="cycle-row">
            <div class="row-header"><span>Cycle 0: Parental Templates</span></div>
            <div class="strand-tray">
                <div class="icon" style="background:var(--parent)"></div>
                <div class="icon" style="background:var(--parent)"></div>
            </div>
        </div>
    </div>

    <div id="controls">
        <button id="step-btn" onclick="nextStep()">MELT DNA</button>
        <button style="background:#eee; color:#666" onclick="location.reload()">RESET</button>
    </div>

    <script>
        /* --- SECURITY --- */
        if (!window.location.hostname.includes('wynscape.github.io') && !window.location.hostname.includes('localhost')) {
            document.body.innerHTML = "";
        }
        document.addEventListener('contextmenu', e => e.preventDefault());

        /* --- LOGIC --- */
        let cycle = 0;
        let step = 0; // 0: Melt, 1: Anneal, 2: Extend
        let isRunning = false;

        async function nextStep() {
            if (isRunning || cycle >= 5) return;
            isRunning = true;
            const btn = document.getElementById('step-btn');
            const status = document.getElementById('status-txt');
            btn.disabled = true;

            if (step === 0) {
                cycle++;
                status.innerText = `C${cycle}: Melting (95°C)`;
                document.getElementById('top-t').style.top = "10%";
                document.getElementById('bot-t').style.bottom = "10%";
                await wait(600);
                step = 1;
                btn.innerText = "ANNEAL PRIMERS";
            } 
            else if (step === 1) {
                status.innerText = `C${cycle}: Annealing (55°C)`;
                document.getElementById('p-f').style.opacity = "1";
                document.getElementById('p-r').style.opacity = "1";
                await wait(600);
                step = 2;
                btn.innerText = "EXTEND STRANDS";
            }
            else if (step === 2) {
                status.innerText = `C${cycle}: Extension (72°C)`;
                const f = document.getElementById('syn-f');
                const r = document.getElementById('syn-r');
                f.style.width = "calc(100% - 25px)";
                r.style.width = "calc(100% - 25px)";
                await wait(1000);
                
                generateCycleResults();
                
                // Reset Stage
                document.getElementById('top-t').style.top = "30%";
                document.getElementById('bot-t').style.bottom = "30%";
                document.getElementById('p-f').style.opacity = "0";
                document.getElementById('p-r').style.opacity = "0";
                f.style.width = "0";
                r.style.width = "0";
                
                step = 0;
                btn.innerText = cycle < 5 ? "MELT DNA (NEXT)" : "MAX CYCLES";
                status.innerText = `Cycle ${cycle} Complete`;
            }

            if (cycle < 5 || step !== 0) btn.disabled = false;
            isRunning = false;
        }

        function generateCycleResults() {
            const panel = document.getElementById('results-panel');
            const row = document.createElement('div');
            row.className = 'cycle-row';

            // Math Logic
            // Total strands = 2 * 2^cycle
            // Linear (Long) = 2 * cycle
            // Exponential (Short) = Total - Long - 2
            const longCount = 2 * cycle;
            const total = 2 * Math.pow(2, cycle);
            const shortCount = total - longCount - 2;

            row.innerHTML = `
                <div class="row-header">
                    <span>Cycle ${cycle} Products</span>
                    <span>Long: <span class="stat-val">${longCount}</span> | Target: <span class="stat-val">${shortCount > 0 ? shortCount : 0}</span></span>
                </div>
                <div class="strand-tray" id="tray-${cycle}"></div>
            `;
            
            panel.appendChild(row);
            const tray = document.getElementById(`tray-${cycle}`);

            // Add Long Icons
            for(let i=0; i<longCount; i++) tray.innerHTML += '<div class="icon i-long"></div>';
            // Add Short Icons
            for(let i=0; i<Math.max(0, shortCount); i++) tray.innerHTML += '<div class="icon i-short"></div>';
            
            panel.scrollTop = panel.scrollHeight;
        }

        function wait(ms) { return new Promise(r => setTimeout(r, ms)); }
    </script>
</body>
</html>
