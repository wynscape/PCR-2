<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PCR </title>
    <style>
        :root {
            --blue: #3498db; --purple: #9b59b6; --green: #2ecc71;
            --brown: #795548; --gray: #ecf0f1; --dark: #2c3e50;
        }
        * { box-sizing: border-box; -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; }
        body { 
            margin: 0; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            background: #ffffff; color: var(--dark); overflow: hidden;
            display: flex; flex-direction: column; height: 100vh;
        }

        /* --- Layout --- */
        #header { padding: 10px 20px; border-bottom: 1px solid var(--gray); display: flex; justify-content: space-between; align-items: center; }
        #main-container { flex: 1; display: flex; position: relative; overflow: hidden; }
        
        /* --- Stage --- */
        #stage { flex: 3; position: relative; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        
        /* --- Yield Margin --- */
        #yield-margin { 
            flex: 1; border-left: 1px solid var(--gray); background: #fafafa; 
            display: flex; flex-direction: column; padding: 10px; font-size: 0.8rem;
        }
        .yield-group { margin-bottom: 20px; }
        .yield-label { font-weight: bold; margin-bottom: 5px; color: #777; font-size: 0.7rem; text-transform: uppercase; }
        .symbol-container { display: flex; flex-wrap: wrap; gap: 4px; }
        .symbol { width: 12px; height: 12px; border-radius: 2px; }
        .sym-linear { background: linear-gradient(to right, var(--blue) 50%, var(--green) 50%); }
        .sym-expo { background: linear-gradient(to right, var(--purple) 50%, var(--green) 50%); }
        .multiplier { font-weight: bold; color: var(--dark); margin-left: 5px; }

        /* --- DNA Animation Elements --- */
        .strand-container { position: relative; width: 80%; height: 100px; transition: all 0.8s ease; }
        .strand { 
            position: absolute; width: 100%; height: 8px; border-radius: 4px; 
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1); 
        }
        .template { background: var(--blue); }
        .new-dna { background: var(--green); height: 0; }
        .primer { 
            position: absolute; width: 30px; height: 12px; background: var(--purple); 
            border-radius: 2px; opacity: 0; transition: opacity 0.5s; 
        }
        .polymerase { 
            position: absolute; width: 20px; height: 20px; background: var(--brown); 
            border-radius: 50%; opacity: 0; transform: translate(-50%, -50%); 
        }

        /* --- Controls --- */
        #controls { 
            padding: 20px; border-top: 1px solid var(--gray); 
            display: flex; justify-content: center; align-items: center; gap: 20px;
        }
        button {
            padding: 12px 24px; font-size: 1rem; font-weight: bold; border: none;
            border-radius: 50px; background: var(--dark); color: white; cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.1s;
        }
        button:active { transform: scale(0.95); }
        button:disabled { background: #ccc; }

        #status-box { text-align: center; min-width: 120px; }
        #cycle-num { font-size: 1.5rem; font-weight: bold; display: block; }
    </style>
</head>
<body>

    <div id="header">
        <div style="font-weight: 800; letter-spacing: 1px;">WYNSCAPE <span style="font-weight: 300; color: #999;">LABS</span></div>
        <div id="phase-text" style="color: var(--purple); font-weight: bold; font-size: 0.9rem;">Ready to start</div>
    </div>

    <div id="main-container">
        <div id="stage">
            <!-- DNA Visuals -->
            <div class="strand-container" id="dna-box">
                <div id="top-strand" class="strand template" style="top: 30%;"></div>
                <div id="bottom-strand" class="strand template" style="bottom: 30%;"></div>
                
                <div id="p1" class="primer" style="top: 35%; left: 0;"></div>
                <div id="p2" class="primer" style="bottom: 35%; right: 0;"></div>
                
                <div id="ext-top" class="strand new-dna" style="top: 30%; right: 0; width: 0;"></div>
                <div id="ext-bottom" class="strand new-dna" style="bottom: 30%; left: 0; width: 0;"></div>
                
                <div id="pol" class="polymerase"></div>
            </div>
        </div>

        <div id="yield-margin">
            <div class="yield-group">
                <div class="yield-label">Linear Increase (Long)</div>
                <div id="linear-symbols" class="symbol-container"></div>
            </div>
            <div class="yield-group">
                <div class="yield-label">Exponential (Target)</div>
                <div id="expo-symbols" class="symbol-container"></div>
            </div>
        </div>
    </div>

    <div id="controls">
        <div id="status-box">
            <span style="font-size: 0.7rem; color: #999;">CYCLE</span>
            <span id="cycle-num">0</span>
        </div>
        <button id="run-btn" onclick="runCycle()">RUN NEXT CYCLE</button>
        <button style="background: #eee; color: #666;" onclick="location.reload()">RESET</button>
    </div>

    <script>
        /* --- SECURITY FEATURES --- */
        // Domain Lock
        if (!window.location.hostname.includes('wynscape.github.io') && !window.location.hostname.includes('localhost')) {
            document.body.innerHTML = "<div style='padding:50px; text-align:center;'><h1>Unauthorized Access</h1><p>This interactive is property of Wynscape. Mirroring is prohibited.</p></div>";
        }
        // Disable Right Click & Dev Tools
        document.addEventListener('contextmenu', event => event.preventDefault());
        document.onkeydown = function(e) {
            if(e.keyCode == 123 || (e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74)) || (e.ctrlKey && e.keyCode == 85)) return false;
        };

        /* --- PCR LOGIC --- */
        let cycle = 0;
        let isAnimating = false;

        async function runCycle() {
            if(isAnimating) return;
            isAnimating = true;
            cycle++;
            document.getElementById('run-btn').disabled = true;

            // 1. Denaturation
            updateStatus("1. Denaturation (95°C)", "#e74c3c");
            document.getElementById('top-strand').style.top = "15%";
            document.getElementById('bottom-strand').style.bottom = "15%";
            await wait(1000);

            // 2. Annealing
            updateStatus("2. Annealing (55°C)", "var(--purple)");
            document.getElementById('p1').style.opacity = "1";
            document.getElementById('p2').style.opacity = "1";
            await wait(800);

            // 3. Extension
            updateStatus("3. Extension (72°C)", "var(--green)");
            const pol = document.getElementById('pol');
            const extTop = document.getElementById('ext-top');
            const extBot = document.getElementById('ext-bottom');
            
            pol.style.opacity = "1";
            extTop.style.height = "8px";
            extBot.style.height = "8px";
            
            // Animate Extension
            for(let i=0; i<=100; i+=2) {
                extTop.style.width = i + "%";
                extBot.style.width = i + "%";
                pol.style.left = i + "%";
                pol.style.top = (Math.random() > 0.5 ? "15%" : "85%");
                await wait(20);
            }

            // End Cycle
            pol.style.opacity = "0";
            document.getElementById('cycle-num').innerText = cycle;
            updateYield();
            
            await wait(500);
            resetVisuals();
            updateStatus("Cycle " + cycle + " Complete", varName('--dark'));
            document.getElementById('run-btn').disabled = false;
            isAnimating = false;
        }

        function updateYield() {
            const linearCount = cycle * 2;
            const total = Math.pow(2, cycle);
            const expoCount = cycle < 3 ? 0 : total - linearCount;

            const linContainer = document.getElementById('linear-symbols');
            const expContainer = document.getElementById('expo-symbols');

            // Render Linear
            linContainer.innerHTML = '';
            for(let i=0; i < Math.min(linearCount, 12); i++) {
                linContainer.innerHTML += '<div class="symbol sym-linear"></div>';
            }
            if(linearCount > 12) linContainer.innerHTML += `<span class="multiplier">x${linearCount}</span>`;

            // Render Exponential
            expContainer.innerHTML = '';
            for(let i=0; i < Math.min(expoCount, 12); i++) {
                expContainer.innerHTML += '<div class="symbol sym-expo"></div>';
            }
            if(expoCount > 12) expContainer.innerHTML += `<span class="multiplier">x${expoCount}</span>`;
            if(cycle >= 3) expContainer.style.background = "#fff9c4"; // Highlight when expo starts
        }

        function resetVisuals() {
            document.getElementById('top-strand').style.top = "30%";
            document.getElementById('bottom-strand').style.bottom = "30%";
            document.getElementById('p1').style.opacity = "0";
            document.getElementById('p2').style.opacity = "0";
            document.getElementById('ext-top').style.width = "0";
            document.getElementById('ext-bottom').style.width = "0";
        }

        function updateStatus(txt, col) {
            const el = document.getElementById('phase-text');
            el.innerText = txt;
            el.style.color = col;
        }

        function wait(ms) { return new Promise(res => setTimeout(res, ms)); }
        function varName(name) { return getComputedStyle(document.documentElement).getPropertyValue(name); }
    </script>
</body>
</html>
