<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PCR Simulation</title>
    <style>
        :root {
            --blue: #2980b9; --purple: #8e44ad; --green: #27ae60;
            --brown: #795548; --bg: #ffffff; --text: #333; --light: #f8f9fa;
        }
        * { box-sizing: border-box; -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; }
        body { 
            margin: 0; font-family: 'Helvetica Neue', Arial, sans-serif; 
            background: var(--bg); color: var(--text); overflow: hidden;
            display: flex; flex-direction: column; height: 100vh;
        }

        /* --- UI Header --- */
        #header { padding: 15px; border-bottom: 1px solid #eee; text-align: center; background: white; z-index: 10; }
        h1 { margin: 0; font-size: 1.1rem; letter-spacing: 1px; color: var(--text); }

        /* --- Layout --- */
        #main { flex: 1; display: flex; position: relative; overflow: hidden; }
        #stage { flex: 3; position: relative; display: flex; flex-direction: column; justify-content: center; align-items: center; border-right: 1px solid #eee; }
        
        /* --- Right Margin Product Gallery --- */
        #gallery { flex: 1.2; background: var(--light); display: flex; flex-direction: column; padding: 15px; overflow-y: auto; }
        .gallery-section { margin-bottom: 20px; }
        .gallery-title { font-size: 0.7rem; font-weight: bold; color: #888; text-transform: uppercase; margin-bottom: 10px; border-bottom: 1px solid #ddd; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(40px, 1fr)); gap: 8px; }
        
        /* Visual DNA Icons */
        .dna-icon { height: 6px; border-radius: 3px; position: relative; }
        .icon-long { background: linear-gradient(90deg, var(--blue) 30%, var(--green) 70%); }
        .icon-target { background: linear-gradient(90deg, var(--purple) 20%, var(--green) 60%, var(--purple) 20%); }

        /* --- Animation Stage Elements --- */
        .dna-workspace { position: relative; width: 85%; height: 200px; }
        .strand { position: absolute; width: 100%; height: 10px; border-radius: 5px; transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        .template-original { background: var(--blue); }
        .new-synthesis { background: var(--green); height: 10px; width: 0; position: absolute; }
        .primer { position: absolute; width: 40px; height: 14px; background: var(--purple); border-radius: 3px; opacity: 0; z-index: 5; }
        .label { position: absolute; font-size: 0.7rem; font-weight: bold; color: #aaa; }

        /* --- Controls --- */
        #controls { padding: 20px; border-top: 1px solid #eee; background: white; display: flex; flex-direction: column; align-items: center; gap: 15px; }
        #slider-container { width: 80%; display: flex; align-items: center; gap: 15px; }
        input[type=range] { flex: 1; cursor: pointer; accent-color: var(--purple); }
        .btn-group { display: flex; gap: 10px; }
        button { padding: 10px 25px; border-radius: 20px; border: none; background: var(--text); color: white; font-weight: bold; cursor: pointer; }
        button:disabled { background: #ccc; }

        /* Phase Indicators */
        #phase-display { font-weight: bold; color: var(--purple); font-size: 0.9rem; height: 1.2rem; }
    </style>
</head>
<body>

    <div id="header"><h1>POLYMERASE CHAIN REACTION</h1></div>

    <div id="main">
        <div id="stage">
            <div id="phase-display">Set slider to start</div>
            <div class="dna-workspace">
                <!-- 5' to 3' template (Top) -->
                <div id="top-t" class="strand template-original" style="top: 30%;"></div>
                <div class="label" style="top: 25%; left: -30px;">5'</div>
                <div class="label" style="top: 25%; right: -30px;">3'</div>
                
                <!-- 3' to 5' template (Bottom) -->
                <div id="bot-t" class="strand template-original" style="bottom: 30%;"></div>
                <div class="label" style="bottom: 25%; left: -30px;">3'</div>
                <div class="label" style="bottom: 25%; right: -30px;">5'</div>

                <!-- Primers & Synthesis -->
                <div id="p-top" class="primer" style="top: 38%; right: 0;"></div> <!-- Binds to 3' of top -->
                <div id="p-bot" class="primer" style="bottom: 38%; left: 0;"></div> <!-- Binds to 3' of bot -->
                
                <div id="syn-top" class="new-synthesis" style="top: 30%; right: 40px;"></div>
                <div id="syn-bot" class="new-synthesis" style="bottom: 30%; left: 40px;"></div>
            </div>
        </div>

        <div id="gallery">
            <div class="gallery-section">
                <div class="gallery-title">Cycle: <span id="cycle-count">0</span></div>
            </div>
            <div class="gallery-section">
                <div class="gallery-title">Long Fragments (Linear)</div>
                <div id="long-fragments" class="product-grid"></div>
            </div>
            <div class="gallery-section">
                <div class="gallery-title">Target Fragments (Exponential)</div>
                <div id="target-fragments" class="product-grid"></div>
            </div>
        </div>
    </div>

    <div id="controls">
        <div id="slider-container">
            <span>Denature</span>
            <input type="range" id="phase-slider" min="0" max="100" value="0">
            <span>Extend</span>
        </div>
        <div class="btn-group">
            <button id="next-btn" onclick="completeCycle()" disabled>FINISH CYCLE</button>
            <button style="background:#eee; color:#666" onclick="location.reload()">RESET</button>
        </div>
    </div>

    <script>
        /* --- SECURITY --- */
        if (!window.location.hostname.includes('wynscape.github.io') && !window.location.hostname.includes('localhost')) {
            document.body.innerHTML = "";
        }
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.onkeydown = e => { if(e.keyCode == 123 || (e.ctrlKey && e.shiftKey && e.keyCode == 73) || (e.ctrlKey && e.keyCode == 85)) return false; };

        /* --- LOGIC --- */
        const slider = document.getElementById('phase-slider');
        const phaseTxt = document.getElementById('phase-display');
        const nextBtn = document.getElementById('next-btn');
        let cycle = 0;

        slider.addEventListener('input', (e) => {
            const val = e.target.value;
            
            // 1. Denaturation (0-30)
            if (val < 33) {
                phaseTxt.innerText = "1. Denaturation (95°C) - Strands Separate";
                document.getElementById('top-t').style.top = (30 - (val/2)) + "%";
                document.getElementById('bot-t').style.bottom = (30 - (val/2)) + "%";
                resetSynthesis();
            } 
            // 2. Annealing (33-66)
            else if (val >= 33 && val < 66) {
                phaseTxt.innerText = "2. Annealing (55°C) - Primers Bind to 3' Ends";
                document.getElementById('p-top').style.opacity = "1";
                document.getElementById('p-bot').style.opacity = "1";
                document.getElementById('syn-top').style.width = "0%";
                document.getElementById('syn-bot').style.width = "0%";
            }
            // 3. Extension (66-100)
            else {
                phaseTxt.innerText = "3. Extension (72°C) - Synthesis Starts";
                const extWidth = ((val - 66) / 34) * 85;
                document.getElementById('syn-top').style.width = extWidth + "%";
                document.getElementById('syn-bot').style.width = extWidth + "%";
                if(val == 100) nextBtn.disabled = false;
            }
        });

        function completeCycle() {
            if (cycle >= 5) return;
            cycle++;
            document.getElementById('cycle-count').innerText = cycle;
            
            // Math Logic: Linear vs Exponential
            const longCount = cycle * 2;
            const total = Math.pow(2, cycle);
            const targetCount = cycle < 3 ? 0 : total - longCount;

            // Update Gallery
            updateGallery(longCount, targetCount);

            // Reset for next cycle
            slider.value = 0;
            nextBtn.disabled = true;
            resetVisuals();
            phaseTxt.innerText = "Cycle " + cycle + " Complete. Start next cycle?";
        }

        function updateGallery(l, t) {
            const lGrid = document.getElementById('long-fragments');
            const tGrid = document.getElementById('target-fragments');
            
            lGrid.innerHTML = '';
            for(let i=0; i<l; i++) lGrid.innerHTML += '<div class="dna-icon icon-long"></div>';
            
            tGrid.innerHTML = '';
            for(let i=0; i<t; i++) tGrid.innerHTML += '<div class="dna-icon icon-target"></div>';
        }

        function resetSynthesis() {
            document.getElementById('p-top').style.opacity = "0";
            document.getElementById('p-bot').style.opacity = "0";
            document.getElementById('syn-top').style.width = "0";
            document.getElementById('syn-bot').style.width = "0";
        }

        function resetVisuals() {
            document.getElementById('top-t').style.top = "30%";
            document.getElementById('bot-t').style.bottom = "30%";
            resetSynthesis();
        }
    </script>
</body>
</html>
